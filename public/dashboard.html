<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Elesfuerzo — Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="./css/style.css" rel="stylesheet" />
</head>

<body>

    <!-- NAV -->
    <nav class="navbar-v3">
        <div class="brand">
            <i class="bi bi-shop" style="color:var(--color-primario)"></i>
            <h1>Elesfuerzo — Panel administrador</h1>
        </div>

        <!-- Menú -->
        <div class="menu" id="topbarMenu">
            <!-- Notificaciones -->
            <button id="btnCampana" class="btn btn-ghost">
                <i class="bi bi-bell"></i>
                <span id="badgeNotifs" class="badge" style="display:none">0</span>
            </button>

            <!-- Usuarios -->
            <button id="btnUsuarios" class="btn btn-ghost">
                <i class="bi bi-people"></i> Usuarios
            </button>

            <!-- Ir a Cajero -->
            <a href="./cajero.html" class="btn btn-ghost">
                <i class="bi bi-cash"></i> Cajero
            </a>

            <!-- Cerrar sesión -->
            <button id="logoutBtn" class="btn btn-ghost">
                <i class="bi bi-box-arrow-right"></i> Cerrar sesión
            </button>
        </div>
    </nav>

    <!--Notificaciones-->
    <div id="notifBar"
        style="position: fixed; top: 60px; right: 12px; width: 320px; max-height: 70vh; overflow:auto;background:#fff; border:1px solid #eee; border-radius:12px; box-shadow: var(--shadow); display:none; z-index:60; padding:12px;">
        <h4 style="margin:0 0 8px 0">Notificaciones</h4>
        <ul id="notificacionesList" class="list"></ul>
    </div>


    <main class="container-v3">
        <!-- ESTADÍSTICAS -->
        <section id="estadisticas" class="section card">
            <div class="card-header">El Esfuerzo — Estadísticas</div>
            <div class="card-body">
                <div class="stats">
                    <div class="stat">
                        <div class="label">Total productos</div>
                        <div id="statTotal" class="value">—</div>
                    </div>
                    <div class="stat">
                        <div class="label">Bajo mínimo</div>
                        <div id="statBajo" class="value">—</div>
                    </div>
                    <div class="stat">
                        <div class="label">Valor de inventario</div>
                        <div id="statValor" class="value">—</div>
                    </div>
                    <div class="stat">
                        <div class="label">Top vendido</div>
                        <div id="statTop" class="value" style="font-size:16px">—</div>
                    </div>
                </div>
            </div>
        </section>

        <div class="row">
            <!-- INVENTARIO -->
            <section id="inventario" class="col section card">
                <div class="card-header">Productos </div>
                <div class="card-body">
                    <!-- Filtros -->
                    <div class="row">
                        <div class="col">
                            <label class="label">Categoría</label>
                            <select id="filtroCategoria" class="input">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="col">
                            <label class="label">Proveedor</label>
                            <input id="filtroProveedor" class="input" placeholder="Ej: Lácteos Ñuble" />
                        </div>
                        <div class="col">
                            <label class="label">Orden</label>
                            <select id="ordenLista" class="input">
                                <option value="nombre">Nombre (A–Z)</option>
                                <option value="cantidadAsc">Menor cantidad</option>
                            </select>
                        </div>
                    </div>

                    <!-- Lista -->
                    <ul id="lista-productos" class="list mt-2"></ul>
                    <div class="mt-2 form-grid">
                        <div>
                            <label class="label" for="proveedorPedido">Proveedor</label>
                            <select id="proveedorPedido" class="input">
                                <option value="">Selecciona proveedor</option>
                            </select>
                        </div>
                        <div>
                            <label class="label" for="productoPedido">Producto</label>
                            <select id="productoPedido" class="input">
                                <option value="">Selecciona producto</option>
                            </select>
                        </div>
                        <div>
                            <label class="label" for="cantidadPedido">Cantidad</label>
                            <input id="cantidadPedido" type="number" min="1" class="input" value="1" />
                        </div>
                        <div class="full">
                            <button id="btnAddPedido" class="btn btn-primary w-100">Agregar al listado</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- PEDIDO -->
            <section id="pedido" class="col section card">
                <div class="card-header">Listado </div>
                <div class="card-body">
                    <ul id="listaPedidos" class="list"></ul>
                    <div class="mt-2">
                        <button id="btnEnviarPedidoWA" class="btn btn-primary"><i class="bi bi-whatsapp"></i>
                            WhatsApp</button>
                        <button id="btnEnviarPedidoMail" class="btn btn-ghost"><i class="bi bi-envelope"></i>
                            Correo</button>
                        <button id="btnLimpiarPedido" class="btn btn-ghost right"><i class="bi bi-trash"></i>
                            Limpiar</button>
                    </div>
                </div>
            </section>
        </div>

        <section class="card" style="margin-top:20px;">
            <h2 class="h1">Historial de ventas</h2>
            <div class="tabla-caja">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Boleta</th>
                            <th>Fecha</th>
                            <th>Total</th>
                            <th>Método</th>
                            <th>Detalle</th>
                        </tr>
                    </thead>
                    <tbody id="tablaVentas"></tbody>
                </table>
            </div>
        </section>
        <br>
        
        <!-- AGREGAR PRODUCTO -->
        <section id="agregar" class="section card">
            <div class="card-header">Registrar nuevo producto</div>
            <div class="card-body">
                <form id="formProducto" class="form-grid">
                    <div>
                        <label class="label" for="codigoBarras">Código de barras</label>
                        <input id="codigoBarras" class="input" placeholder="EAN / UPC" required />
                    </div>
                    <div>
                        <label class="label" for="nombre">Nombre</label>
                        <input id="nombre" class="input" placeholder="Nombre del producto" required />
                    </div>
                    <div>
                        <label class="label" for="cantidad">Cantidad</label>
                        <input id="cantidad" type="number" min="0" class="input" placeholder="0" required />
                    </div>
                    <div>
                        <label class="label" for="precio">Precio</label>
                        <input id="precio" type="number" min="1" class="input" placeholder="0" required />
                    </div>
                    <div>
                        <label class="label" for="categoria">Categoría</label>
                        <input id="categoria" class="input" placeholder="Abarrotes, Mascotas, etc." />
                    </div>
                    <div>
                        <label class="label" for="proveedorSelect">Proveedor</label>
                        <select id="proveedorSelect" class="input">
                            <option value="">— Selecciona proveedor —</option>
                        </select>
                        <input id="proveedorNombre" class="input mt-1" placeholder="(o escribe un proveedor nuevo)" />
                        <button type="button" id="btnNuevoProveedor" class="btn btn-ghost mt-1">+ Agregar
                            proveedor</button>
                    </div>
                    <div class="full">
                        <label class="label" for="minStock">Stock mínimo (alerta)</label>
                        <input id="minStock" type="number" min="0" class="input" value="5" />
                    </div>
                    <div class="full">
                        <button class="btn btn-primary w-100"><i class="bi bi-plus-circle"></i> Agregar
                            producto</button>
                    </div>
                </form>
            </div>
        </section>
    </main>
    <div id="modalProveedor" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.25); z-index:70;">
        <div style="max-width:420px; margin:10% auto; background:#fff; padding:16px; border-radius:12px">
            <h3>Nuevo proveedor</h3>
            <div class="form-grid">
                <div class="full">
                    <label class="label">Nombre</label>
                    <input id="np_nombre" class="input" placeholder="Nombre o empresa" required>
                </div>
                <div>
                    <label class="label">Correo (opcional)</label>
                    <input id="np_email" type="email" class="input" placeholder="correo@ejemplo.com">
                </div>
                <div>
                    <label class="label">Teléfono</label>
                    <input id="np_tel" class="input" placeholder="+569...">
                </div>
                <div class="full">
                    <button id="np_guardar" class="btn btn-primary w-100">Guardar</button>
                </div>
                <div class="full">
                    <button id="np_cerrar" class="btn btn-ghost w-100">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Slidebar Usuarios -->
    <aside id="usuariosPanel" class="notif-panel" style="display:none">
        <div class="panel-header">
            <strong>Usuarios</strong>
            <button id="closeUsuarios" class="btn btn-ghost">Cerrar</button>
        </div>
        <ul id="listaUsuarios" class="list"></ul>
    </aside>

    <div id="modalVenta" class="modal-boleta" style="display:none;">
        <div class="modal-content">
            <h2>BOLETA Nº <span id="hvBoletaId"></span></h2>
            <p><strong>Minimarket El Esfuerzo</strong></p>
            <p>RUT: 5.992.649-7</p>
            <p id="hvFecha"></p>

            <h3>Detalle</h3>
            <ul id="hvDetalle"></ul>

            <p><strong>Subtotal:</strong> <span id="hvSubTotal"></span></p>
            <p><strong>IVA 19%:</strong> <span id="hvIVA"></span></p>
            <p><strong>Total:</strong> <span id="hvTotal"></span></p>
            <p><strong>Método:</strong> <span id="hvMetodoPago"></span></p>
            <p><strong>Pago cliente:</strong> <span id="hvPago"></span></p>
            <p><strong>Vuelto:</strong> <span id="hvVuelto"></span></p>

            <button id="cerrarModalVenta" class="chip" style="margin-top:14px">Cerrar</button>
        </div>
    </div>


    <script type="module" src="./js/app.js"></script>
    <script type="module" src="./js/auth.js"></script>
    <script type="module" src="./elesfuerzo/productos.js"></script>
</body>

</html>